# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## О проекте

"Веб-ларёк" - это виртуальный магазин уникальных товаров. Пользователь может посмотреть каталог на главной странице, прочитать описание выбранного товара и купить его в одном экземпляре. Бесценные товары приобрести нельзя - только любоваться. Перед оформлением заказа можно увидеть в корзине его общую стоимость и, если жалко виртуальных денег, - удалить любые позиции. Выбираем способ оплаты, вводим адрес, телефон и почту - и виртуальные товары в вашем виртуальном кармане!

## Архитектура проекта

"Веб-ларёк" построен на упрощённой модели MVP с применением событийно-ориентированного подхода: слой данных отделён от слоя отображения, а их связь организуется с помощью брокера событий `EventEmitter`. Через `index.ts` в экземпляр брокера императивно передаются названия основных событий и функции, срабатывающие при их наступлении.

### Базовые классы

Надёжные товарищи, предоставляющие базовый функционал: Api, Component, EventEmitter.

**class Api** - обеспечивает взаимодействие приложения с сервером.

Свойства хранят базовую ссылку для запросов к серверу и дополнительные опции:
```typescript
readonly baseUrl: string;
protected options: RequestInit;
constructor(baseUrl: string, options: RequestInit = {})
```
Методы получают и отправляют данные, подставляя нужные эндпоинты и параметры:
```typescript
protected handleResponse(response: Response): Promise<object>;
get(uri: string);
post(uri: string, data: object, method: ApiPostMethods = 'POST');
```

**abstract class Component<T>** - содержит основные методы для работы с DOM-элементами дочерних компонентов. Через дженерик принимает интерфейс класса-наследника, типизирующий данные при рендере.

Единственное свойство хранит контейнер дочернего компонента:
```typescript
protected constructor(protected readonly container: HTMLElement);
```
Методы позволяют переключать класс, менять текст и изображение, скрывать и показывать элемент, менять активность кнопки и, конечно, рендерить весь компонент, наполняя его новыми данными и возвращая готовый контейнер:
```typescript
toggleClass(element: HTMLElement, className: string, force?: boolean);
protected setText(element: HTMLElement, value: unknown);
setDisabled(element: HTMLElement, state: boolean);
protected setHidden(element: HTMLElement);
protected setVisible(element: HTMLElement);
protected setImage(element: HTMLImageElement, src: string, alt?: string);
render(data?: Partial<T>): HTMLElement;
```

### Слой данных

Представлен единственным классом `AppState`, отвечающим за хранение и обработку данных приложения.

Свойства:
- `catalog`: массив всех полученных карточек товара;
- `basket`: массив добавленных в корзину товаров;
- `preview`: данные о товаре, карточка которого открыта;
- `order`: данные из форм заказа для отправки на сервер.

Методы:
- `setCatalog`: инициализирует каталог товаров, записывая в него полученные с сервера объекты;
- `setPreview`: запоминает объект, карточку которого выбрали;
- `isInvaluable`: проверяет, является ли открытый товар бесценным;
- `checkProduct`: проверяет, лежит ли открытый товар в корзине;
- `addToBasket`: добавляет товар в корзину;
- `deleteFromBasket`: убирает товар из корзины;
- `totalPrice` (геттер): считает общую стоимость товаров в корзине.


### Слой отображения

Реализуется с помощью нескольких классов, описывающих отдельные компоненты приложения:

- `Page`: компонент, отображающий данные на главной странице - каталог товаров и счётчик на корзине;
- `Modal`: общее модальное окно, в котором рендерятся другие компоненты;
- `Card`: карточка каталога на главной странице;
- `CardPreview`: карточка открытого товара (возможно, наследуется от Card);
- `Basket`: список товаров в корзине;
- `CardBasket`: элемент товара в корзине;
- `Order`: окно оформления заказа (возможно, будет два класса);
- `Success`: окно успешной покупки.

Все они наследуются от базового класса `Component`, имеющего основные методы работы с отображением и разметкой: рендер, показ и скрытие элементов, установка изображений и текста.

### Слой связи (презентер)

Берёт на себя функции по организации сообщения между двумя другими слоями. В проекте применяется событийно-ориентированный подход, поэтому для связи данных и отображения используется функционал брокера событий (`EventEmitter`). Через `index.ts` в инстанс брокера (events) императивно передаются названия возможных событий и функции, срабатывающие при их наступлении. При этом сам events передаётся в конструктор многих классов проекта, что позволяет обращаться к нему из их экземпляров.

Возможные события и краткое описание последствий:

- `page:load`: отрисовка каталога товаров и счётчика корзины;
- `card:select`: рендер превью товара, запись его объекта в AppState, проверка на бесценность и наличие его в корзине, открытие модального окна, блокировка скролла страницы;
- `product:add`: добавление товара в корзину, текст кнопки в превью меняется на "Убрать", счетчик корзины увеличивается;
- `product:delete`: удаление товара из корзины, пересчет общей стоимости корзины, счетчик корзины уменьшается;
- `basket:open`: рендер корзины, подсчет стоимости, открытие модального окна, блокировка скролла страницы;
- `order:step1`: рендер контента с выбором метода оплаты и полем ввода адреса;
- `order:step2`: запись данных из первого шага в AppState, замена контента в модальном окне;
- `order:send`: запись данных заказа в AppState, отправка запроса с этими данными на сервер;
- `order:success`: вывод сообщения в модальном окне, очистка корзины;
- `modal:close`: закрытие модального окна.

### API

Связь приложения с сервером происходит с помощью базовых методов класса `Api`: get и post. Его расширяет класс `PurchaseApi`, типизирующий получаемые и отправляемые данные, вставляющий базовые адреса и эндпоинты, а также корректирующий ссылки картинок в получаемых объектах.